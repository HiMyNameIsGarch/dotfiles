#!/bin/sh

options="shutdown
reboot
lock screen"

choice=$(printf "%s" "$options" | dmenu -i -p "Choose:")
[ -z "$choice" ] && exit 1
[ "$(printf "Yes\nNo" | dmenu -i -p "Are you sure?")" = "Yes" ] || exit 1

notify() { notify-send "Doom Guy says" "$1" ; }
notifyExit() { notify-send --urgency=critical "$1" "$2" && exit 1 ; }

checkDisks() {
    MOUNTEDDISKS="$(mount | tail -n1 | grep "^/dev/sd.*")"
    [ ! -n "$MOUNTEDDISKS" ]
}
SLEEPNUM=5
logSysShutdown() {
    DATE="$(date '+%A-%B-%Y')"
    OPEN="$(uptime -s)"
    TOTAL="$(uptime -p)"
    FILE="/home/himynameisgarch/logs/sys/uptime"
    echo "${1^} at: $(date '+%T')" >> "$FILE" 
    echo "On $DATE you opened you pc at ${OPEN#* }" >> "$FILE"
    echo "Total time spent: ${TOTAL#* }" >> "$FILE"
    echo "---------------------" >> "$FILE"
}
shutDown() {
    logSysShutdown "shutdown"
    notify "God Rested On The Seventh Day" &
    sleep $SLEEPNUM
    shutdown now
}
rebootSys(){
    logSysShutdown "reboot"
    notify "Don't Leave That Plasma Cutter Running" &
    sleep $SLEEPNUM
    shutdown -r now
}

option() { printf "%s" "$options" | sed "$1q;d" ; }
case $choice in 
    "$(option 1)") 
        checkDisks || 
            notifyExit "Mounted Disks detected!" "You can't shutdown because you have mounted disks!"
        shutDown ;;
    "$(option 2)") 
        checkDisks || 
            notifyExit "Mounted Disks detected!" "You can't reboot because you have mounted disks!"
        rebootSys ;;
    "$(option 3)") notify "Your screen will be locked" ; i3lock-fancy ;;
    *) exit 1 ;; 
esac

