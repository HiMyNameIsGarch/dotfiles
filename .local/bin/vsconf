#!/bin/sh

# Create a vimspector configuration file for debugging (vsconf)

terminate() { printf "%s\n" "$(basename "$0"): $1"; exit 1 ; }
[ -z "$1" ] && terminate "No language provided!"
fileName=".vimspector.json"

if [ -f "$fileName" ]; then
    printf '%s' "The .vimspector config file already exists, override? [Y/N]: "
    read -r res
    case "$res" in
        Y|y) printf '\n%s\n' "Override existing config file...";;
        *) exit 1 ;;
    esac
fi

csharp() {
    basePath=$(pwd)
    dotnetVersion=$(dotnet --version | cut -c 1-3)
    projName="${basePath##*/}"

    # write config to file
    echo "{
  \"configurations\": {
    \"launch - netcoredbg\": {
      \"adapter\": \"netcoredbg\",
      \"filetypes\": [ \"cs\", \"fsharp\", \"vbnet\" ],
      \"configuration\": {
        \"request\": \"launch\",
        \"program\": \"$basePath/bin/Debug/net$dotnetVersion/$projName.dll\",
        \"args\": [ ],
        \"stopAtEntry\": true,
        \"cwd\": \"$basePath\",
        \"env\": {}
      }
    }
  }
} " > "$fileName"

}

typescript() {
    printf "%s\n" "To be added" 
}

case "$1" in 
    cs) csharp ;;
    ts) typescript ;;
    *) terminate "Invalid language!" ;;
esac
